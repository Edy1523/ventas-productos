# Title: Backend for a simulated case of a enterprise that sells cleaning products
---
## Overview: Description of the problem
This document explain in detail how the architecture of the application works, here are images of the templates use in every schema, the basemodels for every parameter that we need form the client, and finally, get save in the database. The backend was made for the enterprise Entregas Condor ltda.

## Stakeholders
**Project owner:** [Mi GitHub profile](https://github.com/Edy1523)

## Assumptions
- This is a high level design, is not ment to hold specifics of implementation of the presented components on this system.
- This is just a simulated case, I created the name of the enterprise and the base, based in an idea of a project that I had meanwhile I was working in one of my GitHub repositories.
- All this idea is made especifically for my CV, and to complete my skills for search work.

## Definitions and Acronyms
**Note:** These terms were taken from: https://fastapi.tiangolo.com/, https://www.psycopg.org/docs/index.html
- Fastapi: Is a modern, fast (high-performance), web framework for building APIs with Python based on standard Python type hints.
- Uvicorn: Is an ASGI web server implementation for Python.
- Postgresql: Is a powerful, open source object-relational database.
- Psycopg: Is the most popular PostgreSQL database adapter for the Python programming language.

### Scope
As a backend developer, I am in charge of the logic of the business, I must create the structure for the paths that the information will get saved and prepared for the SGDB. I take responsability of the servers that contains the application, and create safe workbench for all the roles that take part in the project.
With the front-end team I work in the endpoints and the returns of the testers that take all type of errors or aserts that may apear for the Condor clients.

#### Supported use-cases
The supported cases all the specific things that I have to achive, following the requirements that the enterprise gave me, at an alleged meeting, where the teams and they, talk about what the website should have. But in this documents it will be just the cases for my role as backend developer.

* The website should give the possibility to the customers to buy products without the need to create and account, only with the payment method.
* The employees, and suppliers, must have an account to acces to their functions.
* The deliveries should have and state that gives to the client the possibility to follow the path that his order is.
* It should be a table that contains all the information of the customer purchases, this will be the bill that we returns to them, when the product is delivered.
* The employees, should be able to filter in scalable ways, the deliveries and orders generated by the customers, with the purcharses.
* The suppliers, should be able to filter in scalable ways, the inventories with the information of the stock of the products that are for sale.
* Should be validations of stock that returns updates of products that doesn't have stock in the database. Also should be a validation, when a delivery gets a state of error.
* The filtration of the data that is saved on the database should be done, regardless of spaces, capital letters and lowercases.
* The employees, should update the state of the deliveries, and the customer should see that state update.

### Out of Scope
* Any form of user data collection; no data will be collected in this project.
* The front-end of the website.
* Email notifications are out of scope.
* Cost calculation won't be updated from initial calculation
---
## Proporsal

### Architecture
The architecture is designed based in a high level state for the backend, so the specifications are made in general ways.
The proposed system will have and API for the comunications between the client and server, the server is composed from the database and the backend, for the conecction of the clients query through all the comuncation path of the server will be managed by the driver, psycopg will be in charged of the insert to the database and the returns to the client. The inserts will be used in a basemodel template that will be return to the client in JSONResponse. 

### Architecture Diagram
This is the architecture designed for the high level backend of the application.
![High level Achitecture](<Diagrama arquitectura alto nivel.drawio.png>)

#### External components:
The external components was talked with the enterprise, and basically are the applications where I and the other teams encharged of the project, will be posting special reports about the performance of the web and possible errors that appears in the life time of the web site.
* Discord: This will be the principal channel of meetings. 
* Whatsapp Groups: There will be a special group for every team and the employees in charged from the enterprise.

### Data structures

#### Schemas of the querys
**Clients:**{
            "example":{
                "id":1000000,
                "nombre_cliente":"default",
                "correo":"ex@gmail.com",
                "telefono":3000000000,
                "direccion":"cr cll av #"
            }            
        }

**Employees:**{
            "example":{
                "id":1000000,
                "nombre":"default",
                "puesto":"example",
                "salario":500000,
                "fecha_contratacion":"2000-00-00"
            }            
        }

**Suppliers:**{
            "example":{
                "id":1000000,
                "nombre_proveedor":"default",
                "telefono":3000000000,
                "direccion_proveedor":"cr cll av #"
            }            
        }

**Products:**{
            "example":{
                "nombre_producto":"default",
                "descripcion":"descripcion de como es el producto",
                "precio":100
            }            
        }

**Inventories:**{
            "example":{
                "cantidad":10,
                "ubicacion":"Bodega 1"
            }            
        }

**Orders:**{
            "example":{
                "fecha_pedido":'2000-00-00',
                "estado_pedido":"Estado del envio del producto",
                "cantidad_comprada":10
            }
        }

**Deliveries:**{
            "example":{
                "fecha_entrega":'2000-00-00',
                "estado_entrega":'En Bodega'
            }
        }

**Bill:**{
            "example":{
                "fecha_orden":'2000-00-00',
                "estado_orden":'Terminado'
            }
        }

#### Schema of the postgresql materialized view
**error_delivery:**{
            "example":{
                "descripcion":"descripcion de por qué fallo el envio",
                "tiempo_solucion":"10 días"
            }
        }

#### Schemas of the employees and suppliers login
**employee_login:**{
                "contrasena":'***'
            }            
        }

**supplier_login:**{
                "contrasena":'***'
            }
        }

### Testing Plans
The testing plan are made by two diferent algorithms, called the black box and crystal box, both codes are made for unit test, which means that they only gonna test specifyc functions of the applications not all in same time. The returns of these testers will be one of the topics in the meetings with the enterprise, where I'll talk about several errors or security hollows in the running code.
Additionally in the main code are JSONResponses that have the enough logic to cover 404, 400 and 401 errors, and Fastapi has reponses for bad request or querys that aren't in the base models proposed as template.
The last test that covers the end to end part of the application, is the middleware error handler, implemented with a starlette import, this handler will take any error that could appear in any of the phases of the application, the middleware as fast as finds and 500 error print it with status and a text that shows whats wrong and in what part of the code, which is very usefull in the reports that I have to give to the enterprise.

---
## Limitations
* The server can't handle more than 1000 calls in a second at the same time.
* Server responses have a latency of 2.3 milliseconds.
---

## Costs
Description/Cost analysis

### Monthly cost (30 days) phase 1
example:
Exact cost be calculated as not enough data is available to estimate accurately. However, based on initial calculation(first draft), an educated guess suggest a reduction of aprox 2x. Assumed cost -> aprox Up to $40.00 for 100 cities
Estimated cost goes as follows (per supported city feed):
* Cloudwatch events: $1.00US per 1 Million
* Estimated calls per month: 8640 (every 5 mins for 30 days)
* cloudwatch cost per feed per month: $0.02592 USD
...
#### Images of charts showing numbers of the costs
DynamoDB costs: Upon testing, costs are significantly low to perform a reliable calculation, as shown in the following image. Each execution shows minimal usage on write units (same is for read units) used to calculate cost.

### Monthly Cost (30 day) (calculated on first draft of this proposal)
example:
Costs exclude email/sms publishing
* Up to $20.66 (Mexico city, Guadalajara, Monterrey)
* Up to $58.63 for 100 cities (Mexico city is special case, counts as 16 cities on its own)